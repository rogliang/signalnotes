cat > prisma/schema.prisma << 'EOF'
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Settings {
  id              String   @id @default(cuid())
  ceoFirstName    String?
  ceoAliases      String[]
  contextPrompt   String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Note {
  id              String   @id @default(cuid())
  title           String
  date            DateTime
  subtitle        String?
  content         String   @db.Text
  ceoMentioned    Boolean  @default(false)
  ceoConfidence   String?
  ceoEvidence     String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  actions         Action[]
  topics          TopicMention[]
  tags            Tag[]
  evidences       Evidence[]
  
  @@index([date])
  @@index([ceoMentioned])
}

model Action {
  id              String   @id @default(cuid())
  activity        String
  priority        String   @default("P1")
  dueDate         DateTime?
  status          String   @default("ACTIVE")
  sortScore       Float    @default(0)
  isCeoRelated    Boolean  @default(false)
  isStanding      Boolean  @default(false)
  standingCadence String?
  macroGoalId     String?
  macroGoal       MacroGoal? @relation(fields: [macroGoalId], references: [id])
  completedAt     DateTime?
  lastCompletedAt DateTime?
  completionHistory String[]
  daysStagnant    Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  evidences       Evidence[]
  topics          ActionTopic[]
  
  @@index([status])
  @@index([sortScore])
  @@index([dueDate])
  @@index([isCeoRelated])
}

model Evidence {
  id              String   @id @default(cuid())
  actionId        String
  action          Action   @relation(fields: [actionId], references: [id], onDelete: Cascade)
  noteId          String
  note            Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  excerpt         String
  createdAt       DateTime @default(now())
  
  @@index([actionId])
  @@index([noteId])
}

model Topic {
  id              String   @id @default(cuid())
  name            String
  normKey         String   @unique
  category        String
  frequency       Float    @default(0)
  lastMentioned   DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  mentions        TopicMention[]
  actions         ActionTopic[]
  
  @@index([normKey])
  @@index([frequency])
}

model TopicMention {
  id              String   @id @default(cuid())
  topicId         String
  topic           Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)
  noteId          String
  note            Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  isAsk           Boolean  @default(false)
  isNudge         Boolean  @default(false)
  weight          Float    @default(1.0)
  createdAt       DateTime @default(now())
  
  @@index([topicId, createdAt])
  @@index([noteId])
}

model ActionTopic {
  actionId        String
  action          Action   @relation(fields: [actionId], references: [id], onDelete: Cascade)
  topicId         String
  topic           Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)
  
  @@id([actionId, topicId])
}

model MacroGoal {
  id              String   @id @default(cuid())
  goal            String
  editedByUser    Boolean  @default(false)
  topicKeys       String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  actions         Action[]
  
  @@index([editedByUser])
}

model Tag {
  id              String   @id @default(cuid())
  name            String
  normKey         String
  noteId          String
  note            Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
  
  @@index([normKey])
  @@index([noteId])
}
EOF